<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bread.app.BreadMapper">

    <!-- 상품 등록 -->
    <insert id="insert" parameterType="breadVO">
        <!-- 파일 업로드가 있는 경우와 없는 경우를 처리 -->
        <choose>
            <when test="bread_img != null">
                insert into bc_bread (bread_name, bread_price, bread_content, bread_img, bread_img_save, bakery_idx, bread_stock,
                bread_time1, bread_time2, bread_time3
                ) values (
                #{bread_name}, #{bread_price}, #{bread_content},
                #{bread_img}, #{bread_img_save}, #{bakery_idx}, #{bread_stock},
                #{bread_time1}, #{bread_time2}, #{bread_time3}
                )
            </when>
            <otherwise>
                insert into bc_bread (
                bread_name, bread_price, bread_content, bakery_idx, bread_stock, bread_time1, bread_time2, bread_time3
                ) values (
                #{bread_name}, #{bread_price}, #{bread_content}, #{bakery_idx},#{bread_stock}, #{bread_time1}, #{bread_time2}, #{bread_time3}
                )
            </otherwise>
        </choose>
    </insert>

    <!-- 상품 목록 조회 -->
    <select id="getBoards" parameterType="searchVO"  resultType="breadVO">
        SELECT b.*, ba.bakery_name
        FROM bc_bread b
                 LEFT JOIN bc_bakery ba ON b.bakery_idx = ba.bakery_idx
        WHERE b.bread_del != -1
        ORDER BY b.bread_idx DESC
            LIMIT
        <choose>
            <when test="startIdx >= 0">
                #{startIdx}, 10
            </when>
            <otherwise>
                0, 10
            </otherwise>
        </choose>
    </select>


    <!-- 개별 상품 조회 -->
    <select id="getBoard" parameterType="_int" resultType="breadVO">
        SELECT b.*, bk.bakery_name
        FROM bc_bread b
        INNER JOIN bc_bakery bk ON b.bakery_idx = bk.bakery_idx
        WHERE b.bread_idx = #{bread_idx} AND b.bread_del != -1
    </select>

    <!-- 상품 정보 수정 -->
    <update id="update" parameterType="breadVO">
        update bc_bread
        set
        bread_name = #{bread_name},
        bread_price = #{bread_price},
        bread_content = #{bread_content},
        bread_time1 = #{bread_time1},
        bread_time2 = #{bread_time2},
        bread_time3 = #{bread_time3}
        <choose>
            <when test="bread_img != null">
                ,bread_img = #{bread_img}
                ,bread_img_save = #{bread_img_save}
            </when>
            <otherwise>
                <!-- 파일 정보를 변경하지 않을 때는 해당 필드를 업데이트하지 않음 -->
            </otherwise>
        </choose>
        where bread_idx = #{bread_idx}
    </update>

    <!-- 상품 정보 삭제 -->
    <update id="delete" parameterType="_int">
        update bc_bread
        set bread_del = -1
        where bread_idx = #{bread_idx}
    </update>

    <!-- 추가적인 매퍼 엘리먼트가 필요한 경우 여기에 구현 -->

</mapper>